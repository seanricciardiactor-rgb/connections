<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Connections</title>
  <meta name="theme-color" content="#ffffff" />
  <style>
    :root{
      --bg:#ffffff;
      --tile:#eeede8;
      --tile-border:#e6e5df;
      --tile-text:#111;
      --selected-bg:#5f5f5f;
      --selected-text:#fff;
      --muted:#6b6b6b;

      --btn-border:#111;
      --btn-disabled-border:#d6d6d6;
      --btn-disabled-text:#9a9a9a;

      --yellow:#f5df6b;
      --green:#bfe3a8;
      --blue:#a9d6f5;
      --purple:#d6b0f3;

      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      background:var(--bg);
      color:#111;
      font-family:var(--font);
      -webkit-font-smoothing: antialiased;
      display:flex;
      justify-content:center;
    }

    .page{
      width:100%;
      max-width:430px;
      padding:0 14px 18px;
    }

    /* Header */
    .topbar{
      height:54px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid #ececec;
      padding:0 2px;
      position:sticky;
      top:0;
      background:#fff;
      z-index:5;
    }
    .leftSlot{ width:42px; }
    .rightSlot{ width:42px; } /* spacer */
    .centerIcons{
      display:flex;
      gap:16px;
      align-items:center;
      justify-content:center;
      flex:1;
    }
    .iconBtn{
      width:42px;height:42px;
      display:grid;place-items:center;
      border:0;
      background:transparent;
      padding:0;
      border-radius:10px;
      -webkit-tap-highlight-color: transparent;
    }
    .iconBtn:active{ background:#f2f2f2; }
    svg{ display:block; }

    .instruction{
      text-align:center;
      font-size:22px;
      font-weight:520;
      margin:14px 0 6px;
    }
    .dateLine{
      text-align:center;
      font-size:13px;
      font-weight:600;
      color:#6b6b6b;
      margin:0 0 12px;
      letter-spacing:.2px;
    }

    /* Solved groups */
    .solvedArea{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-bottom:12px;
    }
    .solvedGroup{
      border-radius:10px;
      padding:12px;
      border:1px solid rgba(0,0,0,.06);
      text-align:center;
      transform: translateY(0);
    }
    .solvedGroup.lockIn{
      animation: lockIn 260ms ease-out both;
    }
    @keyframes lockIn{
      0%   { opacity:0; transform: translateY(12px) scale(.985); }
      60%  { opacity:1; transform: translateY(-2px) scale(1.005); }
      100% { opacity:1; transform: translateY(0) scale(1); }
    }
    .solvedTitle{
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:.6px;
      font-size:13px;
      margin-bottom:6px;
    }
    .solvedList{
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:.5px;
      font-size:12.5px;
      line-height:1.15;
    }

    /* Grid */
    .grid{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
    }

    button.tile{
      appearance:none;
      border:1px solid var(--tile-border);
      background:var(--tile);
      color:var(--tile-text);
      border-radius:10px;

      height:60px;
      padding:6px;

      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;

      font-weight:800;
      font-size:10.6px;
      letter-spacing:0.45px;
      text-transform:uppercase;
      line-height:1.05;

      cursor:pointer;
      user-select:none;

      word-break:keep-all;
      overflow-wrap:normal;
      hyphens:none;
      white-space:normal;

      transition: transform 140ms ease, opacity 140ms ease, background-color 120ms ease, color 120ms ease, border-color 120ms ease;
      -webkit-tap-highlight-color: transparent;
    }
    button.tile.selected{
      background:var(--selected-bg);
      color:var(--selected-text);
      border-color:var(--selected-bg);
      transform: translateY(-1px);
    }
    button.tile.leaving{
      opacity:0;
      transform: translateY(10px) scale(.98);
      pointer-events:none;
    }

    .mistakesRow{
      display:flex;
      justify-content:center;
      gap:12px;
      margin:12px 0;
      font-size:18px;
      font-weight:520;
    }
    .dots{ display:flex; gap:10px; }
    .dot{
      width:14px;height:14px;border-radius:50%;
      background:#111;
    }
    .dot.spent{ opacity:.15; }

    /* Buttons row - smaller */
    .controls{
      display:flex;
      gap:10px;
      justify-content:space-between;
      margin-top:2px;
    }
    .btn{
      flex:1;
      border-radius:999px;
      padding:10px 10px;
      font-size:14.5px;
      font-weight:600;
      border:2px solid #111;
      background:#fff;
      color:#111;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:disabled{
      border-color:var(--btn-disabled-border);
      color:var(--btn-disabled-text);
      cursor:not-allowed;
      background:#fff;
    }

    .toast{
      margin-top:10px;
      min-height:20px;
      text-align:center;
      color:var(--muted);
      font-size:15px;
      font-weight:600;
    }

    .reveal{
      display:none;
      margin-top:18px;
      padding:16px;
      border:1px solid #e6e6e6;
      border-radius:16px;
      text-align:center;
      background:#fff;
    }
    .reveal.show{ display:block; }

    /* Confetti canvas overlay */
    #confetti{
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:9999;
    }

    @media (max-width:390px){
      .instruction{ font-size:20px; }
      button.tile{ height:56px; font-size:10.4px; }
      .btn{ font-size:14px; padding:9px 8px; }
      .mistakesRow{ font-size:17px; }
      .dot{ width:13px; height:13px; }
    }
  </style>
</head>
<body>
<canvas id="confetti" aria-hidden="true"></canvas>

<main class="page">
  <header class="topbar" aria-label="Header">
    <div class="leftSlot">
      <button class="iconBtn" aria-label="Menu" type="button" onclick="noop()">
        <svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true">
          <rect x="3" y="6" width="18" height="2" fill="#111"/>
          <rect x="3" y="11" width="18" height="2" fill="#111"/>
          <rect x="3" y="16" width="18" height="2" fill="#111"/>
        </svg>
      </button>
    </div>

    <div class="centerIcons" aria-label="Icons">
      <button class="iconBtn" aria-label="Hints" type="button" onclick="noop()">
        <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M9 21h6v-1H9v1zm3-20a7 7 0 0 0-4 12.7V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-3.3A7 7 0 0 0 12 1zm3 11.9-.8.6V16H9.8v-2.5l-.8-.6A5.5 5.5 0 1 1 15 12.9z" fill="#111"/>
        </svg>
      </button>
      <button class="iconBtn" aria-label="Stats" type="button" onclick="noop()">
        <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
          <rect x="4" y="12" width="3" height="8" fill="#111"/>
          <rect x="10.5" y="9" width="3" height="11" fill="#111"/>
          <rect x="17" y="6" width="3" height="14" fill="#111"/>
        </svg>
      </button>
      <button class="iconBtn" aria-label="Help" type="button" onclick="noop()">
        <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="12" r="10" fill="none" stroke="#111" stroke-width="2"/>
          <path d="M9.8 9.2A2.4 2.4 0 0 1 12 7.8c1.3 0 2.4.9 2.4 2.2 0 1.8-2 1.9-2 3.6" fill="none" stroke="#111" stroke-width="2" stroke-linecap="round"/>
          <circle cx="12" cy="17.6" r="1.2" fill="#111"/>
        </svg>
      </button>
    </div>

    <div class="rightSlot" aria-hidden="true"></div>
  </header>

  <div class="instruction">Create four groups of four!</div>
  <div class="dateLine" id="dateLine"></div>

  <section class="solvedArea" id="solvedArea" aria-label="Solved groups"></section>

  <section class="grid" id="grid" aria-label="Word grid"></section>

  <div class="mistakesRow" aria-label="Mistakes remaining">
    <div>Mistakes Remaining:</div>
    <div class="dots" id="dots"></div>
  </div>

  <div class="controls" aria-label="Controls">
    <button class="btn" id="shuffleBtn" type="button">Shuffle</button>
    <button class="btn" id="clearBtn" type="button" disabled>Deselect All</button>
    <button class="btn" id="submitBtn" type="button" disabled>Submit</button>
  </div>

  <div class="toast" id="toast" aria-live="polite"></div>

  <div class="reveal" id="reveal">
    <h2>üíç Will you marry me?</h2>
    <p style="margin:6px 0 0;color:#6b6b6b;font-weight:650;">(Look up at me.)</p>
  </div>
</main>

<script>
function noop(){}

const CATEGORIES=[
 {color:"yellow",title:"Valentine‚Äôs Day",words:["Heart","Red","Chocolate","Flowers"]},
 {color:"green",title:"2nd Date Movies",words:["Goofy","Jerk","Spaceballs","Cats Don‚Äôt Dance"]},
 {color:"blue",title:"Jesus Meals",words:["Diet Coke","Movie Pretzel","Diet Ginger Ale","Eggplant Parm"]},
 {color:"purple",title:"So Much",words:["Will","You","Marry","Me"]}
];
const COLORS={yellow:"#f5df6b",green:"#bfe3a8",blue:"#a9d6f5",purple:"#d6b0f3"};

let remaining=CATEGORIES.flatMap(c=>c.words.map(w=>({w,c})));
let selected=new Set(), solved=[], mistakes=0;

const grid=document.getElementById("grid"),
      solvedArea=document.getElementById("solvedArea"),
      dots=document.getElementById("dots"),
      clearBtn=document.getElementById("clearBtn"),
      submitBtn=document.getElementById("submitBtn"),
      toast=document.getElementById("toast"),
      reveal=document.getElementById("reveal"),
      dateLine=document.getElementById("dateLine");

function setDateLine(){
  // Looks like a daily date line; uses device date for realism
  const d = new Date();
  const fmt = new Intl.DateTimeFormat(undefined, { weekday:"long", year:"numeric", month:"long", day:"numeric" });
  dateLine.textContent = fmt.format(d);
}

function haptic(pattern){
  // Works on many Android devices; iOS Safari typically ignores
  try{
    if (navigator.vibrate) navigator.vibrate(pattern);
  }catch(e){}
}

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}}
shuffle(remaining);

function renderGrid(){
  grid.innerHTML="";
  remaining.forEach(o=>{
    const b=document.createElement("button");
    b.className="tile"+(selected.has(o.w)?" selected":"");
    b.textContent=o.w;
    b.onclick=()=>toggle(o.w);
    grid.appendChild(b);
  });
}
function renderDots(){
  dots.innerHTML="";
  for(let i=0;i<4;i++){
    const d=document.createElement("div");
    d.className="dot"+(i<mistakes?" spent":"");
    dots.appendChild(d);
  }
}
function renderControls(){
  clearBtn.disabled=selected.size===0;
  submitBtn.disabled=selected.size!==4;
}
function renderSolved(newlyAddedTitle=null){
  solvedArea.innerHTML="";
  solved.forEach(c=>{
    const box=document.createElement("div");
    box.className="solvedGroup";
    if (newlyAddedTitle && c.title===newlyAddedTitle) box.classList.add("lockIn");
    box.style.background=COLORS[c.color] || "#eee";
    box.innerHTML=`<div class="solvedTitle">${c.title}</div>
                   <div class="solvedList">${c.words.join(", ")}</div>`;
    solvedArea.appendChild(box);
  });
}
function renderAll(newlyAddedTitle=null){
  renderSolved(newlyAddedTitle);
  renderGrid();
  renderDots();
  renderControls();
}

function toggle(w){
  if(selected.has(w)) selected.delete(w);
  else if(selected.size<4) selected.add(w);
  toast.textContent="";
  // small haptic on selection toggle
  haptic(10);
  for (const btn of grid.querySelectorAll("button.tile")){
    btn.classList.toggle("selected", selected.has(btn.textContent));
  }
  renderControls();
}

/* Confetti */
const confettiCanvas = document.getElementById("confetti");
const ctx = confettiCanvas.getContext("2d");
let confettiParticles = [];
let confettiRAF = null;

function resizeConfetti(){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  confettiCanvas.width = Math.floor(window.innerWidth * dpr);
  confettiCanvas.height = Math.floor(window.innerHeight * dpr);
  confettiCanvas.style.width = window.innerWidth + "px";
  confettiCanvas.style.height = window.innerHeight + "px";
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener("resize", resizeConfetti);
resizeConfetti();

function launchConfetti(){
  confettiParticles = [];
  const count = 160;
  const w = window.innerWidth, h = window.innerHeight;
  for (let i=0;i<count;i++){
    confettiParticles.push({
      x: Math.random()*w,
      y: -20 - Math.random()*h*0.2,
      vx: (Math.random()-0.5)*2.5,
      vy: 2.5 + Math.random()*3.0,
      r: 3 + Math.random()*4,
      rot: Math.random()*Math.PI,
      vr: (Math.random()-0.5)*0.2,
      life: 0,
      max: 120 + Math.random()*60,
      color: ["#f5df6b","#bfe3a8","#a9d6f5","#d6b0f3","#111111"][Math.floor(Math.random()*5)]
    });
  }

  if (confettiRAF) cancelAnimationFrame(confettiRAF);
  tickConfetti();
  // stop after ~2.5s
  setTimeout(()=>{ confettiParticles=[]; }, 2600);
}

function tickConfetti(){
  ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
  const w = window.innerWidth, h = window.innerHeight;
  confettiParticles = confettiParticles.filter(p => p.life < p.max && p.y < h + 30);
  for (const p of confettiParticles){
    p.life++;
    p.x += p.vx;
    p.y += p.vy;
    p.rot += p.vr;
    // tiny sway
    p.x += Math.sin((p.life/10)+p.rot)*0.6;

    ctx.save();
    ctx.translate(p.x, p.y);
    ctx.rotate(p.rot);
    ctx.fillStyle = p.color;
    ctx.fillRect(-p.r, -p.r/2, p.r*2, p.r);
    ctx.restore();
  }
  if (confettiParticles.length){
    confettiRAF = requestAnimationFrame(tickConfetti);
  }else{
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
  }
}

document.getElementById("shuffleBtn").onclick=()=>{
  shuffle(remaining);
  toast.textContent="";
  haptic(15);
  renderGrid();
  renderControls();
};
document.getElementById("clearBtn").onclick=()=>{
  selected.clear();
  toast.textContent="";
  haptic(15);
  renderGrid();
  renderControls();
};

document.getElementById("submitBtn").onclick=async ()=>{
  if(selected.size!==4) return;
  const pick=[...selected];
  const cat=CATEGORIES.find(c=>pick.every(w=>c.words.includes(w)));

  if(!cat){
    mistakes=Math.min(4, mistakes+1);
    toast.textContent="Not quite.";
    haptic([20,30,20]);
    selected.clear();
    renderDots();
    renderGrid();
    renderControls();
    return;
  }

  if(solved.some(s=>s.title===cat.title)){
    selected.clear();
    renderGrid();
    renderControls();
    return;
  }

  // haptic on correct submit
  haptic([20,20,30]);

  const selectedButtons=[...grid.querySelectorAll("button.tile")].filter(b=>selected.has(b.textContent));
  selectedButtons.forEach(b=>b.classList.add("leaving"));
  await new Promise(r=>setTimeout(r, 160));

  solved.push(cat);
  remaining=remaining.filter(o=>!cat.words.includes(o.w));
  selected.clear();
  toast.textContent="Correct!";

  renderAll(cat.title);

  if(solved.length===4){
    reveal.classList.add("show");
    toast.textContent="";
    // bigger celebration haptic + confetti
    haptic([30,30,60]);
    launchConfetti();
  }
};

setDateLine();
renderAll();
</script>
</body>
</html>
